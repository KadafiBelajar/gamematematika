<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Battle Screen - Level {{ level_num }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    <script src="{{ url_for('static', filename='assets-config.js') }}"></script>
    <script src="{{ url_for('static', filename='character-animator.js') }}"></script>
    <script src="{{ url_for('static', filename='sound-manager.js') }}"></script>
    <script src="{{ url_for('static', filename='camera-follow.js') }}"></script>
    <script>
      MathJax = {
        tex: { inlineMath: [['$', '$']], displayMath: [['$$', '$$']] },
        svg: { fontCache: 'global' }
      };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script"></script>
    <script src="{{ url_for('static', filename='main.js') }}?v=BATTLE_V3" defer></script>
</head>
<body class="battle-screen">
    <div class="battle-background">
        <div class="stars-layer"></div>
        <div class="particles-layer" id="particles-container"></div>
    </div>

    <div class="fight-container" data-stage-name="{{ stage_name }}" data-level-num="{{ level_num }}" data-camera-viewport>
        
        <div class="timer-container">
            <div class="timer-frame">
                <svg class="timer-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M12 6v6l4 2"/>
                </svg>
                <span id="timer-display" class="timer-display">90</span>
                <span class="timer-label">SEC</span>
            </div>
        </div>

        <div class="battle-hud">
            <div class="combatant-section player-section" data-world>
                <div class="avatar-container player-avatar" id="player-avatar" data-player>
                    <div class="avatar-glow"></div>
                    <div class="avatar-frame">
                        <svg viewBox="0 0 100 100" class="avatar-icon">
                            <path d="M50 10 L90 90 L10 90 Z" fill="currentColor"/>
                            <circle cx="50" cy="40" r="15" fill="rgba(0,0,0,0.3)"/>
                        </svg>
                    </div>
                    <div class="avatar-border"></div>
                </div>
                <div class="hp-section">
                    <div class="combatant-info">
                        <span class="combatant-label">PLAYER</span>
                        <span class="combatant-name">Mathius</span>
                    </div>
                    <div class="hp-container">
                        <span class="hp-percentage" id="player-hp-text">100%</span>
                        <div class="hp-bar-wrapper">
                            <div class="hp-bar-bg"></div>
                            <div id="player-hp-bar" class="hp-bar-fill player" style="width: 100%;">
                                <div class="hp-bar-shine"></div>
                            </div>
                            <div class="hp-bar-border"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="vs-badge">
                <span>VS</span>
            </div>

            <!-- Boss Section (Icon di sebelah kanan bar HP) -->
            <div class="combatant-section boss-section">
                <div class="hp-section">
                    <div class="combatant-info boss-info">
                        <span class="combatant-label">BOSS</span>
                        <span class="combatant-name">Calculus Demon</span>
                    </div>
                    <div class="hp-container">
                        <span class="hp-percentage boss-hp" id="boss-hp-text">100%</span>
                        <div class="hp-bar-wrapper boss-hp-wrapper">
                            <div class="hp-bar-bg"></div>
                            <div id="boss-hp-bar" class="hp-bar-fill boss" style="width: 100%;">
                                <div class="hp-bar-shine"></div>
                            </div>
                            <div class="hp-bar-border"></div>
                        </div>
                    </div>
                </div>
                <div class="avatar-container boss-avatar" id="boss-avatar">
                    <div class="avatar-glow boss-glow"></div>
                    <div class="avatar-frame boss-frame">
                        <svg viewBox="0 0 100 100" class="avatar-icon">
                            <circle cx="50" cy="35" r="20" fill="currentColor"/>
                            <path d="M30 60 Q50 45 70 60 L65 80 Q50 70 35 80 Z" fill="currentColor"/>
                            <circle cx="42" cy="32" r="4" fill="rgba(255,50,50,0.8)"/>
                            <circle cx="58" cy="32" r="4" fill="rgba(255,50,50,0.8)"/>
                        </svg>
                    </div>
                    <div class="avatar-border boss-border"></div>
                </div>
            </div>
        </div>

        <div class="question-panel">
            <div class="question-header">
                <svg class="question-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
                </svg>
                <span class="question-title">SOLVE THE EQUATION</span>
            </div>
            <div id="question-area" class="question-content">
                <p>Memuat soal...</p>
            </div>
        </div>

        <div id="options-container" class="answer-grid"></div>

        <div class="action-buttons">
            <button id="submit-btn" class="action-btn attack-btn" disabled>
                <span class="btn-icon">⚔️</span>
                <span class="btn-text">SERANG!</span>
            </button>
            <button id="continue-btn" class="action-btn continue-btn hidden">
                <span class="btn-icon">➤</span>
                <span class="btn-text">LANJUTKAN</span>
            </button>
        </div>

        <div id="feedback-area" class="feedback-area"></div>

        <button id="heal-btn" class="heal-btn" title="Heal (+25 HP)">
            <svg viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="0.5">
                <path d="M7 11l5 -6l5 6l-5 12l-5 -12z"/>
            </svg>
            <span>HEAL</span>
        </button>

        <!-- Tombol Pause di Kiri Bawah -->
        <button id="pause-btn" class="pause-btn" title="Pause Game">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <rect x="6" y="4" width="4" height="16"/>
                <rect x="14" y="4" width="4" height="16"/>
            </svg>
            <span>PAUSE</span>
        </button>

        <!-- Game Over Overlay -->
        <div id="game-over-overlay" class="overlay hidden">
            <div class="overlay-content defeat">
                <h2 class="overlay-title defeat-title">GAME OVER</h2>
                <p class="overlay-message">You have been defeated...</p>
                <div class="overlay-buttons">
                    <button id="retry-btn" class="overlay-btn retry-btn">
                        <span>↻</span> TRY AGAIN
                    </button>
                    <a href="{{ url_for('level_select', stage_name=stage_name) }}" class="overlay-btn menu-btn">
                        <span>☰</span> BACK TO MAIN MENU
                    </a>
                </div>
            </div>
        </div>

        <!-- Victory Overlay -->
        <div id="victory-overlay" class="overlay hidden">
            <div class="overlay-content victory">
                <h2 class="overlay-title victory-title">YOU WIN!</h2>
                <p class="overlay-message">You have conquered the demon!</p>
                <div class="overlay-buttons">
                    <a href="{{ url_for('level_select', stage_name=stage_name) }}" class="overlay-btn menu-btn">
                        <span>☰</span> BACK TO MAIN MENU
                    </a>
                    <button id="next-level-btn" class="overlay-btn next-level-btn">
                        <span>→</span> GO TO THE NEXT LEVEL
                    </button>
                </div>
            </div>
        </div>

        <!-- Pause Menu Overlay -->
        <div id="pause-overlay" class="overlay hidden">
            <div class="overlay-content pause-menu-content">
                <h2 class="overlay-title pause-title">PAUSED</h2>
                <div class="pause-menu-buttons">
                    <button id="resume-btn" class="overlay-btn resume-btn">
                        <span>▶</span> RESUME
                    </button>
                    <button id="restart-btn" class="overlay-btn restart-btn">
                        <span>↻</span> RESTART
                    </button>
                    <button id="settings-btn" class="overlay-btn settings-btn">
                        <span>⚙</span> SETTINGS
                    </button>
                    <a href="{{ url_for('level_select', stage_name=stage_name) }}" class="overlay-btn menu-btn">
                        <span>☰</span> BACK TO MAIN MENU
                    </a>
                </div>
            </div>
        </div>

        <!-- Settings Menu Overlay -->
        <div id="settings-overlay" class="overlay hidden">
            <div class="overlay-content settings-content">
                <h2 class="overlay-title settings-title">SETTINGS</h2>
                <div class="settings-panel">
                    <div class="setting-item">
                        <label class="setting-label">
                            <svg class="setting-icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/>
                            </svg>
                            <span>Background Music</span>
                        </label>
                        <div class="volume-control">
                            <input type="range" id="music-volume" class="volume-slider" min="0" max="100" value="50">
                            <span id="music-volume-value" class="volume-value">50%</span>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">
                            <svg class="setting-icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 3v9.28c-.47-.17-.97-.28-1.5-.28C8.01 12 6 14.01 6 16.5S8.01 21 10.5 21c2.31 0 4.2-1.75 4.45-4H15V6h4V3h-7z"/>
                            </svg>
                            <span>Sound Effects</span>
                        </label>
                        <div class="volume-control">
                            <input type="range" id="sfx-volume" class="volume-slider" min="0" max="100" value="50">
                            <span id="sfx-volume-value" class="volume-value">50%</span>
                        </div>
                    </div>
                </div>
                <div class="settings-buttons">
                    <button id="settings-back-btn" class="overlay-btn settings-back-btn">
                        <span>←</span> BACK
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="attack-effects"></div>
</body>
</html>