<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Main Gameplay</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script>
      MathJax = {
        tex: { inlineMath: [['$', '$']], displayMath: [['$$', '$$']] },
        svg: { fontCache: 'global' }
      };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script"></script>
    <script src="{{ url_for('static', filename='main.js') }}?v=FIXEDV2" defer></script>
    <style>
        /* CRITICAL FIX: Pastikan overlay benar-benar tersembunyi */
        .overlay.hidden {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
        }
        
        /* Overlay visible */
        .overlay {
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
    </style>
</head>
<body>
    <div class="fight-container" data-stage-name="{{ stage_name }}" data-level-num="{{ level_num }}">
        
        <div class="fight-ui">
            <div class="hud player-hud">
                <div class="hud-info">
                    <span class="hud-name">Player</span>
                    <span id="player-hp-text" class="hud-hp-text">100 / 100</span>
                </div>
                <div class="hp-bar">
                    <div id="player-hp-bar" class="hp-bar-inner player" style="width: 100%;"></div>
                </div>
            </div>

            <div id="timer-display" class="timer-display">60</div>

            <div class="hud boss-hud">
                 <div class="hud-info">
                    <span class="hud-name">Boss</span>
                    <span id="boss-hp-text" class="hud-hp-text">100 / 100</span>
                </div>
                <div class="hp-bar">
                    <div id="boss-hp-bar" class="hp-bar-inner boss" style="width: 100%;"></div>
                </div>
            </div>
        </div>
        
        <div id="game-content">
            <h1 style="margin: 0; padding: 0;">Level {{ level_num }}</h1>
            <div id="question-area"><p>Memuat...</p></div>
            <div id="options-container" class="options-grid"></div>
            <button id="submit-btn" disabled>Serang!</button>
            <div id="feedback-area"></div>
            <button id="continue-btn" class="hidden">Lanjutkan</button>
        </div>

        <!-- GAME OVER OVERLAY - HARUS HIDDEN BY DEFAULT -->
        <div id="game-over-overlay" class="overlay hidden" style="display: none;">
            <div class="overlay-content">
                <h2>Game Over</h2>
                <button id="retry-btn">Try Again</button>
                <a href="{{ url_for('index') }}" class="button-link">Back to Main Menu</a>
            </div>
        </div>

        <!-- VICTORY OVERLAY - HARUS HIDDEN BY DEFAULT -->
        <div id="victory-overlay" class="overlay hidden" style="display: none;">
            <div class="overlay-content">
                <h2>You Win!</h2>
                <p>Level Cleared!</p>
                <a href="{{ url_for('level_select', stage_name=stage_name) }}" class="button-link">Back to Level Select</a>
            </div>
        </div>
    </div>
</body>
</html>